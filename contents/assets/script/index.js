var e={241:(e,t,i)=>{i.r(t),i.d(t,{openFilter:()=>n,saveAsFilter:()=>s,exportFilter:()=>a});const n=[{value:"md",text:"Markdown (*.md, *.markdown)",exts:[".md",".markdown"],mime:"text/markdown"},{value:"html",text:"HTML (*.html, *.htm)",exts:[".html",".htm"],mime:"text/html"},{value:"*",text:"All Files (*.*)",exts:[],mime:"*/*"}],s=[{value:"md",text:"Markdown (*.md, *.markdown)",exts:[".md",".markdown"],mime:"text/markdown"},{value:"*",text:"All Files (*.*)",exts:[],mime:"*/*"}],a=[].concat(window._MDNE_BACKEND_CAPS_NO_PDF_RENDERER?[]:[{value:"pdf",text:"PDF (*.pdf)",exts:[".pdf"],mime:"application/pdf"}],[{value:"html",text:"HTML (*.html, *.htm)",exts:[".html",".htm"],mime:"text/html"},{value:"*",text:"All Files (*.*)",exts:[],mime:"*/*"}])}},t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={};i.r(e),i.d(e,{carlo:()=>U,fileExists:()=>_,getBaseName:()=>B,getDirName:()=>I,getStartupFile:()=>W,listDesktopDirectory:()=>$,listDirectory:()=>N,listHomeDirectory:()=>T,loadFile:()=>P,nativeAlert:()=>x,nativeAlertSync:()=>S,nativeConfirm:()=>k,nativeConfirmSync:()=>b,nativeFileOpenDialog:()=>A,nativeFileSaveDialog:()=>E,nativeNotifyEditorDirty:()=>C,openNewWindow:()=>j,openURL:()=>L,pathJoin:()=>O,renderByMenneu:()=>D,resourceBaseDirectory:()=>v,rpc:()=>z,saveFile:()=>F,saveFileAs:()=>R});var t={};i.r(t),i.d(t,{carlo:()=>Oe,fileExists:()=>De,getBaseName:()=>Re,getDirName:()=>Fe,getStartupFile:()=>Ne,listDesktopDirectory:()=>Ae,listDirectory:()=>be,listHomeDirectory:()=>Ee,loadFile:()=>xe,nativeAlert:()=>me,nativeAlertSync:()=>fe,nativeConfirm:()=>ge,nativeConfirmSync:()=>we,nativeFileOpenDialog:()=>ye,nativeFileSaveDialog:()=>ve,nativeNotifyEditorDirty:()=>pe,openNewWindow:()=>Te,openURL:()=>$e,pathJoin:()=>Pe,renderByMenneu:()=>Ce,resourceBaseDirectory:()=>ue,rpc:()=>_e,saveFile:()=>Se,saveFileAs:()=>ke});var n={};let s,a,r,o,l,c,d,h,u,p,m,f,g,w,y;i.r(n),i.d(n,{carlo:()=>Et,fileExists:()=>yt,getBaseName:()=>xt,getDirName:()=>Ct,getStartupFile:()=>St,listDesktopDirectory:()=>gt,listDirectory:()=>ft,listHomeDirectory:()=>wt,loadFile:()=>ut,nativeAlert:()=>at,nativeAlertSync:()=>rt,nativeConfirm:()=>ot,nativeConfirmSync:()=>lt,nativeFileOpenDialog:()=>ct,nativeFileSaveDialog:()=>dt,nativeNotifyEditorDirty:()=>st,openNewWindow:()=>bt,openURL:()=>kt,pathJoin:()=>vt,renderByMenneu:()=>ht,resourceBaseDirectory:()=>nt,rpc:()=>At,saveFile:()=>pt,saveFileAs:()=>mt}),"CARLO_RPC"===window._MDNE_BACKEND_TYPE&&(window._MDNE_BACKEND_CAPS_NO_PDF_RENDERER=!1,window._MDNE_BACKEND_CAPS_NO_PDF_PREVIEW_PLUGIN=!1,s=window.renderByMenneu,a=window.loadFile,r=window.saveFile,o=window.listDirectory,l=window.listDesktopDirectory,c=window.listHomeDirectory,d=window.fileExists,h=window.pathJoin,u=window.getDirName,p=window.getBaseName,m=window.getStartupFile,f=window.openURL,g=window.openNewWindow,w=window.rpc,y=window.carlo);const v=void 0,C=undefined,x=undefined,S=undefined,k=undefined,b=undefined,A=undefined,E=undefined,D=s,P=a,F=r,R=r,N=o,$=l,T=c,_=d,O=h,I=u,B=p,W=m,L=f,j=g,z=w,U=y;let q,K,H,Y,V,X,J,G,Q,Z,ee,te,ie,ne,se,ae,re,oe,le,ce,de,he;if("ELECTRON_IPC"===window._MDNE_BACKEND_TYPE){const e=mdneApi.getKey();window._MDNE_BACKEND_CAPS_NO_PDF_RENDERER=!1,window._MDNE_BACKEND_CAPS_NO_PDF_PREVIEW_PLUGIN=!1,q=t=>{mdneApi.send(e,"app:editor:notifyEditorDirty",{dirty:t})},K=async(t,i)=>await mdneApi.ipc(e,"app:editor:nativeAlert",{message:t,type:i}),H=(t,i)=>mdneApi.ipcSync(e,"app:editor:nativeAlertSync",{message:t,type:i}),Y=async(t,i)=>await mdneApi.ipc(e,"app:editor:nativeConfirm",{message:t,type:i}),V=(t,i)=>mdneApi.ipcSync(e,"app:editor:nativeConfirmSync",{message:t,type:i}),X=async(t,i,n)=>await mdneApi.ipc(e,"app:editor:nativeFileOpenDialog",{title:t,defaultPath:i,filters:n}),J=async(t,i,n,s)=>await mdneApi.ipc(e,"app:editor:nativeFileSaveDialog",{title:t,defaultPath:i,filters:n}),G=async(t,i,n,s,...a)=>await mdneApi.ipc(e,"app:editor:renderByMenneu",{source:t,data:i,options:n,srcPath:s,exportPath:a}),Q=async(...t)=>await mdneApi.ipc(e,"app:editor:loadFile",{filePath:t}),Z=async(t,...i)=>await mdneApi.ipc(e,"app:editor:saveFile",{text:t,filePath:i}),ee=async(...t)=>await mdneApi.ipc(e,"app:editor:listDirectory",{dirPath:t}),te=async()=>await mdneApi.ipc(e,"app:editor:listDesktopDirectory",{}),ie=async()=>await mdneApi.ipc(e,"app:editor:listHomeDirectory",{}),ne=async(...t)=>await mdneApi.ipc(e,"app:editor:fileExists",{filePath:t}),se=async(...t)=>await mdneApi.ipc(e,"app:editor:pathJoin",{filePath:t}),ae=async t=>await mdneApi.ipc(e,"app:editor:getDirName",{filePath:t}),re=async t=>await mdneApi.ipc(e,"app:editor:getBaseName",{filePath:t}),oe=async()=>await mdneApi.ipc(e,"app:editor:getStartupFile",{}),le=async t=>await mdneApi.ipc(e,"app:editor:openURL",{url:t}),ce=async()=>await mdneApi.ipc(e,"app:editor:openNewWindow",{});class t{async setFrontend(e){this.frontend_=e,(async()=>{})()}async runCommand(t){return await mdneApi.ipc(e,"app:editor:Backend:runCommand",{command:t})}async runCommandAST(t){return await mdneApi.ipc(e,"app:editor:Backend:runCommandAST",{ast:t})}}const i=new t;de={handle:e=>e},he={loadParams:async()=>[i],fileInfo:async e=>({path:e.path,fileBodyText:await xe(e.path)})},mdneApi.on(e,"app:editor:Frontend:runCommand",(async(e,t)=>{try{let n=i.frontend_.runCommand(t.command);n instanceof Promise&&(n=await n),e.sender.send("app:editor:Frontend:runCommand",{succeeded:!0,payload:n})}catch(t){e.sender.send("app:editor:Frontend:runCommand",{succeeded:!1,error:t.message})}})),document.addEventListener("keyup",(t=>{122===t.keyCode&&(mdneApi.ipc(e,"app:editor:toggleFullScreen",{}),t.preventDefault())}),!1)}const ue=void 0,pe=q,me=K,fe=H,ge=Y,we=V,ye=X,ve=J,Ce=G,xe=Q,Se=Z,ke=Z,be=ee,Ae=te,Ee=ie,De=ne,Pe=se,Fe=ae,Re=re,Ne=oe,$e=le,Te=ce,_e=de,Oe=he;let Me,Ie,Be,We,Le,je,ze,Ue,qe,Ke,He,Ye,Ve,Xe,Je,Ge,Qe,Ze;function et(e){return e.filter((e=>e.extensions.length&&"*"!==e.extensions[0])).map((e=>({description:e.name,accept:{[e.mime]:e.extensions.map((e=>`.${e}`))}})))}if(!window._MDNE_BACKEND_TYPE||"BROWSER_EMULATION"===window._MDNE_BACKEND_TYPE||"EXTERNAL_MIXED"===window._MDNE_BACKEND_TYPE){var tt;window._MDNE_BACKEND_TYPE=null!==(tt=window._MDNE_BACKEND_TYPE)&&void 0!==tt?tt:"BROWSER_EMULATION",window._MDNE_BACKEND_CAPS_NO_PDF_RENDERER=!0,window._MDNE_BACKEND_CAPS_NO_PDF_PREVIEW_PLUGIN=!0,window._MDNE_BACKEND_RESOURCE_BASE_DIR&&(Me=window._MDNE_BACKEND_RESOURCE_BASE_DIR);const e=!!window._MDNE_BACKEND_SHOW_WELCOME_FILE,t=window._mdneReplacementMacros?Array.isArray(window._mdneReplacementMacros)?window._mdneReplacementMacros.slice():[]:[{re:/!!!lsx\s([\s\S]+?)!!!/g,fn:"lsx"}],n="assets/data/welcome.md";let s=null,a=null;async function it(e,t,...n){let r=await vt(...n),o=await xt(r);const l=menneu.getAppEnv().RedAgateUtil,c=await Promise.resolve().then(i.bind(i,241));let d=e?a:s,h=!1;if(window.showSaveFilePicker){if(!d){const t=await dt("","",c.saveAsFilter.map((e=>({name:e.text,extensions:e.exts&&e.exts.length>0?e.exts.map((e=>e.slice(1))):["*"],mime:e.mime}))),e?"export":"saveas");d=e?a:s,d&&t&&(r=o=t)}if(d){const e=await d.createWritable();await e.write(t),await e.close(),h=!0}e&&(a=null)}if(h||await l.FileSaver.saveTextAs(o,t),!e)try{window.location.hash=`filename=${encodeURIComponent(o)}&open.d=${l.Base64.encode(pako.deflate(l.TextEncoding.encodeToUtf8(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}`}catch(e){}return{path:r,name:o}}window.showOpenFilePicker&&(Ie=async(e,t,i)=>{try{const[e]=await window.showOpenFilePicker({types:et(i)});return s=e,[(await s.getFile()).name]}catch(e){return}}),window.showSaveFilePicker&&(Be=async(e,t,i,n)=>{try{const e=await window.showSaveFilePicker({types:et(i)}),t=await e.getFile();switch(n){case"saveas":s=e;break;case"export":a=e}return t.name}catch(e){return}}),We=async(e,i,n,s,...a)=>{const r=Object.assign({},n,{replacementMacros:t});if(!r.outputFormat||"html"!==r.outputFormat.toLowerCase()){const e=`output format ${r.outputFormat} is not available.`;throw new Error(e)}let o=(await menneu.render(e,{},r)).toString();0===a.length&&(o+="\n<style>\n::-webkit-scrollbar {\n    width: 13px;\n    height: 13px;\n}\n::-webkit-scrollbar-track {\n    border-style: solid;\n    border-width: 1px;\n    border-color: rgb(88, 88, 88);\n    background-color: rgb(56, 56, 56);\n}\n::-webkit-scrollbar-thumb {\n    border-style: solid;\n    border-width: 1px;\n    border-color: rgb(88, 88, 88);\n    background-color: rgb(102, 102, 102);\n}\n</style>\n");const l=URL.createObjectURL(new Blob([o],{type:"text/html"}));return a.length>0&&it(!0,o,...a),setTimeout((()=>URL.revokeObjectURL(l)),5e3),l},Le=async(...e)=>{if(s){const e=await s.getFile();return await e.text()}{const e=await fetch(n);return await e.text()}},je=async(e,...t)=>await it(!1,e,...t),ze=async(...e)=>({directory:"",files:[{name:".",isDirectory:!0}]}),Ue=async()=>({directory:"/",files:[{name:".",isDirectory:!0}]}),qe=async()=>({directory:"/",files:[{name:".",isDirectory:!0}]}),Ke=async(...e)=>!1,He=async(...e)=>{const t=e.filter((e=>e.length>0)).join("/").replace(/\/+/g,"/"),i=t.split("/"),n=[];for(const e of i)switch(e){case".":case"":break;case"..":n.pop();break;default:e.match(/^[.]+$/)?n.pop():n.push(e)}return(t.startsWith("/")?"/":"")+n.join("/")},Ye=async e=>{let t=e;return t=-1!==t.lastIndexOf("/")?t.substring(0,t.lastIndexOf("/")):"",t},Ve=async e=>e.substring(e.lastIndexOf("/")+1),Xe=async()=>{let t,i;const s=menneu.getAppEnv().RedAgateUtil;if(window.location.hash){const e={};if(window.location.hash.substring(1).split("&").forEach((t=>{const i=t.split("=");e[i[0]]=decodeURIComponent(i[1])})),window.location.hash.indexOf("open.d=")>=0){if(e["open.d"]){t=e.filename||"Untitled.md";try{i=`data:text/plain;base64,${s.Base64.encode(pako.inflate(s.Base64.decode(e["open.d"].replace(/-/g,"+").replace(/_/g,"/"))))}`}catch(e){}}}else window.location.hash.indexOf("open.url=")>=0?e["open.url"]&&(t=e["open.url"].substring(e["open.url"].lastIndexOf("/")+1)||"index",i=e["open.url"]):e.filename&&(t=e.filename,i="data:text/plain,")}if(!i){if(!e)return;t="Welcome.md",i=n}const a=await fetch(i,{});if(a.ok)return{path:t,text:await a.text()};throw new Error("Fetching url failed. Network response was not ok, or CORB error.")},Je=async e=>(window.open(e,"_blank","noopener"),!0),Ge=async()=>(window.open(`${window.location.pathname}${e?"#filename=Untitled.md":""}`,"_blank","noopener"),!0);const r=(()=>{let e=Object.assign({},liyad.defaultConfig);return e.reservedNames=Object.assign({},e.reservedNames,{Template:"$concat"}),e=liyad.installCore(e),e=liyad.installArithmetic(e),e=liyad.installSequence(e),e=liyad.installConcurrent(e),e.stripComments=!0,e.returnMultipleRoot=!0,liyad.SExpressionAsync(e)})();r.setGlobals({}).install((e=>{const t=[{name:"$>",fn:(e,t)=>(...e)=>new Promise(((e,t)=>{t(new Error("cannot execute shell"))}))}];return e.funcs=(e.funcs||[]).concat(t),e}));class o{async setFrontend(e){this.frontend_=e,(async()=>{})()}async runCommand(e){return r(e)}async runCommandAST(e){return r.evaluateAST(e)}}const l=new o;Qe={handle:e=>e},Ze={loadParams:async()=>[l],fileInfo:async e=>new Promise(((t,i)=>{s=null;const n=new FileReader;n.onload=i=>{t({path:e.name,fileBodyText:n.result})},n.onerror=e=>{i(n.error)},n.readAsText(e,"UTF-8")}))}}const nt=Me,st=undefined,at=undefined,rt=undefined,ot=undefined,lt=undefined,ct=Ie,dt=Be,ht=We,ut=Le,pt=je,mt=je,ft=ze,gt=Ue,wt=qe,yt=Ke,vt=He,Ct=Ye,xt=Ve,St=Xe,kt=Je,bt=Ge,At=Qe,Et=Ze;var Dt;let Pt=null;Pt="CARLO_RPC"===window._MDNE_BACKEND_TYPE?e:"ELECTRON_IPC"===window._MDNE_BACKEND_TYPE?t:"EXTERNAL"===window._MDNE_BACKEND_TYPE?{...window._mdneExternalBackend}:"EXTERNAL_MIXED"===window._MDNE_BACKEND_TYPE?"function"==typeof window._mdneExternalBackend?{...n,...window._mdneExternalBackend(n)}:{...n,...window._mdneExternalBackend}:n;const Ft=null!==(Dt=Pt.resourceBaseDirectory)&&void 0!==Dt?Dt:"",Rt=Pt.nativeNotifyEditorDirty,Nt=Pt.nativeAlert,$t=(Pt.nativeAlertSync,Pt.nativeConfirm),Tt=Pt.nativeConfirmSync,_t=Pt.nativeFileOpenDialog,Ot=Pt.nativeFileSaveDialog,Mt=Pt.renderByMenneu,It=Pt.loadFile,Bt=Pt.saveFile,Wt=Pt.saveFileAs,Lt=Pt.listDirectory,jt=Pt.listDesktopDirectory,zt=Pt.listHomeDirectory,Ut=Pt.fileExists,qt=Pt.pathJoin,Kt=Pt.getDirName,Ht=Pt.getBaseName,Yt=Pt.getStartupFile,Vt=Pt.openURL,Xt=Pt.openNewWindow,Jt=Pt.rpc,Gt=Pt.carlo,Qt=(()=>{let e=Object.assign({},liyad.defaultConfig);return e.reservedNames=Object.assign({},e.reservedNames,{Template:"$concat"}),e=liyad.installCore(e),e=liyad.installArithmetic(e),e=liyad.installSequence(e),e=liyad.installConcurrent(e),e.stripComments=!0,e.returnMultipleRoot=!0,liyad.SExpressionAsync(e)})();Qt.setGlobals({});const Zt=Qt,ei=new class{runCommand(e){return Zt(e)}};let ti=null;const ii={AppName:"Markdown Editor",AceEditor:null,filePath:null,inputFormat:"md",fileChanged:!1,skipDropDialog:!1,invalidate:()=>{}};function ni(){document.title=`${ii.AppName} - ${ii.fileChanged?"● ":""}${ii.filePath||"(New file)"}`,document.getElementById("appIndicatorBar").innerText=`${ii.fileChanged?"● ":""}${ii.filePath||"(New file)"} | mode: ${ii.inputFormat}`}const si=ii,ai=e=>{si.fileChanged=e,Rt&&Rt(e)},ri=async e=>{Nt?await Nt(String(e)):alert(e)},oi=async e=>$t?await $t(String(e)):confirm(e);function li(e){switch(e.lastIndexOf(".")>=0?e.toLowerCase().slice(e.lastIndexOf(".")):""){case".md":case".markdown":return"md";case".html":case".htm":return"html";case".lisp":case".lsx":return"lisp";case".tex":return"tex";case".latex":return"latex";case".css":return"css";case".less":return"less";case".sass":return"sass";case".scss":return"scss";case".json":return"json";case".json5":return"json5";case".js":case".mjs":case".cjs":return"js";case".jsx":return"jsx";case".ts":return"ts";case".tsx":return"tsx";case".svg":return"svg";case".xml":return"xml";case".yaml":case".yml":return"yaml";case".toml":return"toml";case".ini":return"ini";case".graphql":case".gql":return"graphql";case".proto":case".proto2":case".proto3":return"protobuf";case".sql":return"sql";case".cs":return"csharp";case".go":return"golang";case".rb":return"ruby";case".rs":return"rust";case".py":return"python";case".java":return"java";case".kt":return"kotlin";case".r":return"r";case".sh":return"sh";case".dockerfile":return"dockerfile";case".makefile":return"makefile";default:return e.toLowerCase().endsWith("dockerfile")?"dockerfile":e.toLowerCase().endsWith("makefile")?"makefile":"text"}}function ci(e){switch(e){case"md":case"html":case"lisp":return!0;default:return!1}}function di(e){switch(e){case"md":return"ace/mode/markdown";case"html":return"ace/mode/html";case"lisp":return"ace/mode/lisp";case"tex":return"ace/mode/tex";case"latex":return"ace/mode/latex";case"css":return"ace/mode/css";case"less":return"ace/mode/less";case"sass":return"ace/mode/sass";case"scss":return"ace/mode/scss";case"json":return"ace/mode/json";case"json5":return"ace/mode/json5";case"js":return"ace/mode/javascript";case"jsx":return"ace/mode/jsx";case"ts":return"ace/mode/typescript";case"tsx":return"ace/mode/tsx";case"svg":return"ace/mode/svg";case"xml":return"ace/mode/xml";case"yaml":return"ace/mode/yaml";case"toml":return"ace/mode/toml";case"ini":return"ace/mode/ini";case"graphql":return"ace/mode/graphqlshema";case"protobuf":return"ace/mode/protobuf";case"sql":return"ace/mode/sql";case"csharp":return"ace/mode/csharp";case"golang":return"ace/mode/golang";case"ruby":return"ace/mode/ruby";case"rust":return"ace/mode/rust";case"python":return"ace/mode/python";case"java":return"ace/mode/java";case"kotlin":return"ace/mode/kotlin";case"r":return"ace/mode/r";case"sh":return"ace/mode/sh";case"dockerfile":return"ace/mode/dockerfile";case"makefile":return"ace/mode/makefile";case"text":return"ace/mode/text";default:return}}class hi extends React.Component{constructor(e){super(e),this.state={},this.editor=null,this.outerWrapRef=React.createRef()}componentDidMount(){this.editor=ace.edit(this.props.id),this.editor.setFontSize(this.props.fontSize),this.editor.setTheme("ace/theme/monokai"),this.editor.session.setMode("ace/mode/markdown"),this.editor.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Cmd-S"},exec:async e=>{if(si.filePath)try{const t=await Bt(e.getValue(),si.filePath);si.filePath=t.path,si.inputFormat=li(si.filePath),e.session.setMode(di(si.inputFormat)),e.session.getUndoManager().markClean(),ai(!1),ni()}catch(e){await ri(e)}else this.props.onSaveAs({})}}),this.editor.on("change",(e=>{this.props.onChange&&this.props.onChange(e)})),this.editor.session.on("changeScrollTop",(e=>{this.props.onChangeScrollTop&&this.props.onChangeScrollTop(e,this.editor.session.getScreenLength()*this.editor.renderer.lineHeight)})),this.editor.session.on("changeScrollLeft",(e=>{this.props.onChangeScrollLeft&&this.props.onChangeScrollLeft(e)})),si.AceEditor=si.AceEditor||{},si.AceEditor[this.props.id]=this.editor}render(){return lsx`
        (div (@ (ref ${this.outerWrapRef})
                (className
                    ($concat "AceEditorOuterWrap"
                             ${this.props.stretched?" stretched":""}
                             ${this.props.collapsed?" collapsed":""} )))
            (div (@ (id ${this.props.id})
                    (className "AceEditorDiv") )))`}}var ui=i(241);class pi extends React.Component{constructor(e){super(e),this.dialogRef=React.createRef()}showModal(e,t){this.options=e,this.handler=t,si.skipDropDialog?this.handleOnOpenDialogClick(null):(this.dialogRef.current.showModal(),document.activeElement.blur())}openFile(e,t){si.filePath=e,si.inputFormat=li(si.filePath),ai(!1),ni();const i=si.AceEditor[this.options.aceId];i.clearSelection(),i.session.setMode(di(si.inputFormat)),i.setValue(t),i.clearSelection(),i.session.getUndoManager().markClean(),i.moveCursorTo(0,0)}openFileAndClose(e,t){this.openFile(e,t),document.activeElement.blur(),this.dialogRef.current.close(),this.handler()}handleOnDragOver(e){e.stopPropagation(),e.preventDefault()}async handleOnDrop(e){try{e.preventDefault();const t=[];for(let i=0;i<e.dataTransfer.files.length;i++){t.push(Gt.fileInfo(e.dataTransfer.files[i]));break}const i=await Promise.all(t),n=await Promise.all(i.map((e=>e.fileBodyText?Promise.resolve(e.fileBodyText):It(e.path))));this.openFileAndClose(i[0].path,n[0])}catch(e){await ri(e),si.filePath=null,ai(!1),ni()}}async handleOnOpenDialogClick(e){e&&this.handleCancelClick(e);try{this.options.fileOpenDialog.showModal({title:"Open",currentAceId:this.options.aceId,currentFilePath:si.filePath,fileTypes:ui.openFilter},(async(e,t)=>{const i=await qt(e,t),n=await It(i);this.openFileAndClose(i,n)}))}catch(e){await ri(e),si.filePath=null,ai(!1),ni()}}handleCancelClick(e){document.activeElement.blur(),this.dialogRef.current.close()}render(){return lsx`
        (dialog (@ (ref ${this.dialogRef})
                   (style (backgroundColor "#333")
                          (color "white") ))
            (h5 "Open file")
            (div (@ (style (width "80vw")
                           (height "70vh")
                           (display "table-cell")
                           (textAlign "center")
                           (verticalAlign "middle") )
                    (onDragOver ${e=>{this.handleOnDragOver(e)}})
                    (onDragLeave ${()=>{}})
                    (onDrop ${async e=>{await this.handleOnDrop(e)}}) )
                (i (@ (className "material-icons large")) "insert_drive_file")(br)
                "Drop file here." (br)(br)(br)
                (a (@ (style (cursor "pointer")
                             (color "white")
                             (border-bottom "1px solid white") )
                      (onClick ${e=>{this.handleOnOpenDialogClick(e)}}) )
                      "Or click here to open the file dialog." ))
            (div (@ (style (display "flex")
                           (justifyContent "center") ))
                (button (@ (style (textTransform "none")
                                  (margin "0 3px 0 3px")
                                  (width "9em") )
                           (className "btn grey darken-3")
                           (onClick ${e=>this.handleCancelClick(e)}) )
                    (i (@ (className "material-icons large")) "cancel")
                    (span (@ (style (margin "0 10px 10px 10px")
                                    (display "inline-block")
                                    (vertical-align "middle") )) "Cancel") )))`}}class mi extends React.Component{constructor(e){super(e),this.state={},this.state.title="",this.state.currentFilePath="",this.state.fileTypes=[],this.state.selectedFileType="*",this.state.currentDir="",this.state.currentDirFiles=[],this.state.inputFileName="",this.dialogRef=React.createRef(),this.fileNameInputRef=React.createRef(),this.fileTypeSelectorRef=React.createRef()}showModal(e,t){this.setState({title:e.title}),this.setState({currentFilePath:e.currentFilePath}),this.setState({fileTypes:e.fileTypes});let i=e.fileTypes[0];this.setState({selectedFileType:i.value}),this.setState({currentDir:""}),this.setState({currentDirFiles:[]}),this.setState({inputFileName:""}),this.options=e,this.handler=t,_t?(async()=>{const t=await _t(e.title,e.currentFilePath,e.fileTypes.map((e=>({name:e.text,extensions:e.exts&&e.exts.length>0?e.exts.map((e=>e.slice(1))):["*"],mime:e.mime}))));t&&this.handler(await Kt(t[0]),await Ht(t[0]))})():(this.dialogRef.current.showModal(),document.activeElement.blur(),Lt(e.currentFilePath).then((e=>{this.setState({currentDir:e.directory}),this.setState({currentDirFiles:e.files})})).catch((e=>{jt().then((e=>{this.setState({currentDir:e.directory}),this.setState({currentDirFiles:e.files})})).catch((e=>{zt().then((e=>{this.setState({currentDir:e.directory}),this.setState({currentDirFiles:e.files})})).catch((e=>{ri(e)}))}))})))}handleFileListItemClick(e,t,i){i?(this.fileNameInputRef.current.focus(),this.setState({inputFileName:""}),Lt(this.state.currentDir,t).then((e=>{this.setState({currentDir:e.directory}),this.setState({currentDirFiles:e.files})})).catch((e=>{ri(e)}))):(this.fileNameInputRef.current.focus(),this.setState({inputFileName:t}))}async handleOkClick(e){try{if(""===this.state.inputFileName.trim())return;let e=this.state.inputFileName;if(!await Ut(this.state.currentDir,e))return void await ri("File does not exist.");this.handler(this.state.currentDir,e),document.activeElement.blur(),this.dialogRef.current.close()}catch(e){await ri(e)}}getFilteredCurrentDirFiles(){return this.state.currentDirFiles.filter((e=>{if(e.isDirectory)return!0;let t=e.name;const i=t.lastIndexOf(".")>=0?t.toLowerCase().slice(t.lastIndexOf(".")):"";let n=this.options.fileTypes.filter((e=>e.value===this.state.selectedFileType))[0];return!n||!n.exts||0===n.exts.length||n.exts.filter((e=>e===i))[0]}))}handleCancelClick(e){document.activeElement.blur(),this.dialogRef.current.close()}render(){return lsx`
        (dialog (@ (ref ${this.dialogRef})
                   (style (backgroundColor "#333")
                          (color "white") ))
            (h5 ${this.state.title})
            (div ${this.state.currentDir})
            (div (@ (style (width "80vw")
                           (height "70vh")
                           (display "table-cell")
                           (textAlign "center") ))
                (div (@ (style (color "black")
                               (text-align "left")
                               (height "calc(100% - 100px)")
                               (overflow-x "auto")
                               (overflow-y "scroll") ))
                    (ul (@ (className "collection")
                           (style (margin "0")) )
                        ($=for ${this.getFilteredCurrentDirFiles()}
                            (li (@ (key $index)
                                   (className "collection-item"))
                                (a (@ (onClick (|-> (ev) use ($data)
                                          (${(e,t,i)=>this.handleFileListItemClick(e,t,i)}
                                              ev ::$data:name ::$data:isDirectory )))
                                      (style (cursor "pointer")
                                             (color "inherit")
                                             (text-decoration "none") ))
                                    (i (@ (className "material-icons tiny")
                                          (style (margin "0 10px 10px 10px")) )
                                        ($if ::$data:isDirectory "folder" "insert_drive_file") )
                                    ::$data:name )) )))
                (div (@ (className "row"))
                    (div (@ (className "input-field col s10"))
                        (label "File name")
                        (input (@ (ref ${this.fileNameInputRef})
                                  (style (color "white"))
                                  (type "text")
                                  (spellcheck "false")
                                  (readonly "readonly")
                                  (onChange ${()=>this.setState({inputFileName:this.fileNameInputRef.current.value})})
                                  (value ${this.state.inputFileName}) )))
                    (div (@ (className "input-field col s2"))
                        (select (@ (ref ${this.fileTypeSelectorRef})
                                   (className "browser-default")
                                   (onChange ${()=>this.setState({selectedFileType:this.fileTypeSelectorRef.current.value})}) )
                            ($=for ${this.state.fileTypes}
                                (option (@ (key   ::$data:value)
                                           (value ::$data:value)
                                           (($if (== ${this.state.selectedFileType} ::$data:value)
                                               "selected" "data-x-no-selected" )))
                                    ::$data:text ))))))
            (div (@ (style (display "flex")
                           (justifyContent "center") ))
                (button (@ (style (textTransform "none")
                                  (margin "0 3px 0 3px")
                                  (width "9em") )
                           (className "btn grey darken-3")
                           (onClick ${e=>this.handleCancelClick(e)}) )
                    (i (@ (className "material-icons large")) "cancel")
                    (span (@ (style (margin "0 10px 10px 10px")
                                    (display "inline-block")
                                    (vertical-align "middle") )) "Cancel") )
                (button (@ (style (textTransform "none")
                                  (margin "0 3px 0 3px")
                                  (width "9em") )
                           (className "btn blue darken-2")
                           (onClick ${e=>this.handleOkClick(e)}) )
                    (i (@ (className "material-icons large")) "check")
                    (span (@ (style (margin "0 10px 10px 10px")
                                    (display "inline-block")
                                    (vertical-align "middle") )) "OK") ) ))`}}class fi extends React.Component{constructor(e){super(e),this.state={},this.state.title="",this.state.currentFilePath="",this.state.fileTypes=[],this.state.selectedFileType="*",this.state.currentDir="",this.state.currentDirFiles=[],this.state.inputFileName="",this.dialogRef=React.createRef(),this.fileNameInputRef=React.createRef(),this.fileTypeSelectorRef=React.createRef()}showModal(e,t){this.setState({title:e.title}),this.setState({currentFilePath:e.currentFilePath}),this.setState({fileTypes:e.fileTypes});const i=e.currentFilePath&&e.currentFilePath.lastIndexOf(".")>=0?e.currentFilePath.toLowerCase().slice(e.currentFilePath.lastIndexOf(".")):"";let n=e.fileTypes.filter((e=>e.exts.filter((e=>e===i))[0]))[0],s=e.fileTypes.filter((e=>"*"===e.value))[0];this.setState({selectedFileType:e.forExport?e.fileTypes[0].value:n?n.value:""!==i?s.value:e.fileTypes[0].value}),this.setState({currentDir:""}),this.setState({currentDirFiles:[]}),this.setState({inputFileName:""}),this.options=e,this.handler=t,Ot?(async()=>{const t=await Ot(e.title,e.currentFilePath,e.fileTypes.map((e=>({name:e.text,extensions:e.exts&&e.exts.length>0?e.exts.map((e=>e.slice(1))):["*"],mime:e.mime}))),e.intent);t&&this.handler(await Kt(t),await Ht(t))})():(this.dialogRef.current.showModal(),document.activeElement.blur(),Lt(e.currentFilePath).then((e=>{this.setState({currentDir:e.directory}),this.setState({currentDirFiles:e.files})})).catch((e=>{jt().then((e=>{this.setState({currentDir:e.directory}),this.setState({currentDirFiles:e.files})})).catch((e=>{zt().then((e=>{this.setState({currentDir:e.directory}),this.setState({currentDirFiles:e.files})})).catch((e=>{ri(e)}))}))})),Ht(e.currentFilePath).then((e=>{this.fileNameInputRef.current.focus(),this.setState({inputFileName:e})})).catch((e=>{})))}handleFileListItemClick(e,t,i){i?(this.fileNameInputRef.current.focus(),Lt(this.state.currentDir,t).then((e=>{this.setState({currentDir:e.directory}),this.setState({currentDirFiles:e.files})})).catch((e=>{ri(e)}))):(this.fileNameInputRef.current.focus(),this.setState({inputFileName:t}))}async handleOkClick(e){try{if(""===this.state.inputFileName.trim())return;let e=this.state.inputFileName;const t=e.lastIndexOf(".")>=0?e.toLowerCase().slice(e.lastIndexOf(".")):"";let i=this.options.fileTypes.filter((e=>e.value===this.state.selectedFileType))[0];if(""===t&&i?e+=i.exts[0]||"":i.exts.filter((e=>e===t))[0]||(e+=i.exts[0]||""),await Ut(this.state.currentDir,e)&&!await oi("Are you sure want to overwrite the existing file?"))return;this.handler(this.state.currentDir,e),document.activeElement.blur(),this.dialogRef.current.close()}catch(e){await ri(e)}}getFilteredCurrentDirFiles(){return this.state.currentDirFiles.filter((e=>{if(e.isDirectory)return!0;let t=e.name;const i=t.lastIndexOf(".")>=0?t.toLowerCase().slice(t.lastIndexOf(".")):"";let n=this.options.fileTypes.filter((e=>e.value===this.state.selectedFileType))[0];return!n||!n.exts||0===n.exts.length||n.exts.filter((e=>e===i))[0]}))}handleCancelClick(e){document.activeElement.blur(),this.dialogRef.current.close()}render(){return lsx`
        (dialog (@ (ref ${this.dialogRef})
                   (style (backgroundColor "#333")
                          (color "white") ))
            (h5 ${this.state.title})
            (div ${this.state.currentDir})
            (div (@ (style (width "80vw")
                           (height "70vh")
                           (display "table-cell")
                           (textAlign "center") ))
                (div (@ (style (color "black")
                               (text-align "left")
                               (height "calc(100% - 100px)")
                               (overflow-x "auto")
                               (overflow-y "scroll") ))
                    (ul (@ (className "collection")
                           (style (margin "0")) )
                        ($=for ${this.getFilteredCurrentDirFiles()}
                            (li (@ (key $index)
                                   (className "collection-item"))
                                (a (@ (onClick (|-> (ev) use ($data)
                                          (${(e,t,i)=>this.handleFileListItemClick(e,t,i)}
                                              ev ::$data:name ::$data:isDirectory )))
                                      (style (cursor "pointer")
                                             (color "inherit")
                                             (text-decoration "none") ))
                                    (i (@ (className "material-icons tiny")
                                          (style (margin "0 10px 10px 10px")) )
                                        ($if ::$data:isDirectory "folder" "insert_drive_file") )
                                    ::$data:name )) )))
                (div (@ (className "row"))
                    (div (@ (className "input-field col s10"))
                        (label "File name")
                        (input (@ (ref ${this.fileNameInputRef})
                                  (style (color "white"))
                                  (type "text")
                                  (spellcheck "false")
                                  (onChange ${()=>this.setState({inputFileName:this.fileNameInputRef.current.value})})
                                  (value ${this.state.inputFileName}) )))
                    (div (@ (className "input-field col s2"))
                        (select (@ (ref ${this.fileTypeSelectorRef})
                                   (className "browser-default")
                                   (onChange ${()=>this.setState({selectedFileType:this.fileTypeSelectorRef.current.value})}) )
                            ($=for ${this.state.fileTypes}
                                (option (@ (key   ::$data:value)
                                           (value ::$data:value)
                                           (($if (== ${this.state.selectedFileType} ::$data:value)
                                               "selected" "data-x-no-selected" )))
                                    ::$data:text ))))))
            (div (@ (style (display "flex")
                           (justifyContent "center") ))
                (button (@ (style (textTransform "none")
                                  (margin "0 3px 0 3px")
                                  (width "9em") )
                           (className "btn grey darken-3")
                           (onClick ${e=>this.handleCancelClick(e)}) )
                    (i (@ (className "material-icons large")) "cancel")
                    (span (@ (style (margin "0 10px 10px 10px")
                                    (display "inline-block")
                                    (vertical-align "middle") )) "Cancel") )
                (button (@ (style (textTransform "none")
                                  (margin "0 3px 0 3px")
                                  (width "9em") )
                           (className "btn blue darken-2")
                           (onClick ${e=>this.handleOkClick(e)}) )
                    (i (@ (className "material-icons large")) "check")
                    (span (@ (style (margin "0 10px 10px 10px")
                                    (display "inline-block")
                                    (vertical-align "middle") )) "OK") ) ))`}}class gi extends React.Component{constructor(e){super(e),this.state={},this.state.showFields=!1,this.state.fontFamily=void 0,this.state.fontSize=14,this.state.useSoftTabs=!0,this.state.tabSize=4,this.state.wrap=!1,this.state.showInvisibles=!1,this.state.darkThemePreview=!1,this.state.theme="monokai",this.state.enableSnippets=!1,this.dialogRef=React.createRef()}showModal(e,t){this.dialogRef.current.showModal(),document.activeElement.blur(),this.options=e,this.handler=t,this.setState({showFields:!1,fontFamily:e.editor.fontFamily,fontSize:e.editor.fontSize>0?e.editor.fontSize:14,useSoftTabs:!!e.editor.useSoftTabs,tabSize:e.editor.tabSize,wrap:"off"!==e.editor.wrap&&"free"===e.editor.wrap,showInvisibles:!!e.editor.showInvisibles,theme:(e.editor.theme||"").replace("ace/theme/",""),enableSnippets:!!e.editor.enableSnippets,darkThemePreview:!!e.renderer.darkThemePreview,skipDropDialog:!!e.app.skipDropDialog}),setTimeout((()=>this.setState({showFields:!0})),30)}componentDidUpdate(){M.updateTextFields();const e=document.querySelectorAll("select");M.FormSelect.init(e,{})}handleFontFamilyChange(e){this.setState({fontFamily:""===(e.target.value||"").trim()?null:e.target.value})}handleFontSizeChange(e){this.setState({fontSize:e.target.value})}handleTabSizeChange(e){this.setState({tabSize:Math.floor(Number(e.target.value))})}handleSoftTabsChange(e){this.setState({useSoftTabs:e.target.checked})}handleWrapChange(e){this.setState({wrap:e.target.checked})}handleShowInvisiblesChange(e){this.setState({showInvisibles:e.target.checked})}handleEnableSnippetsChange(e){this.setState({enableSnippets:e.target.checked})}handleDarkThemePreviewChange(e){this.setState({darkThemePreview:e.target.checked})}handleSkipDropDialogChange(e){this.setState({skipDropDialog:e.target.checked})}handleThemeChange(e){this.setState({theme:e.target.value})}handleOkClick(e){document.activeElement.blur(),this.dialogRef.current.close();const t=Number(this.state.fontSize);this.handler({editor:{fontFamily:this.state.fontFamily,fontSize:t>0?t:14,useSoftTabs:this.state.useSoftTabs,tabSize:this.state.tabSize>0?this.state.tabSize:4,wrap:this.state.wrap,showInvisibles:this.state.showInvisibles,theme:`ace/theme/${this.state.theme}`,enableBasicAutocompletion:this.state.enableSnippets,enableSnippets:this.state.enableSnippets,enableLiveAutocompletion:this.state.enableSnippets},renderer:{darkThemePreview:this.state.darkThemePreview},app:{skipDropDialog:this.state.skipDropDialog}})}handleCancelClick(e){document.activeElement.blur(),this.dialogRef.current.close()}render(){return lsx`
        (dialog (@ (ref ${this.dialogRef})
                   (className "appSettingsDialog-root")
                   (style (backgroundColor "#333")
                          (color "white") ))
            (style (@ (dangerouslySetInnerHTML """$concat
                .appSettingsDialog-root .select-wrapper input {
                    color: white;
                }
                .appSettingsDialog-root .select-wrapper svg.caret {
                    fill: white;
                }
                """) ))
            (h5 "Settings")
            (div (@ (style (width "80vw")
                           (height "70vh")
                           (display "table-cell")
                           (textAlign "center")
                           (paddingTop "20px") ))
                ($if ${this.state.showFields} (form
                    (div (@ (className "row")
                            (style (margin "0")) )
                        (div (@ (className "input-field col s12"))
                            (input (@ (id "appSettingsDialog-fontFamily")
                                      (type "text")
                                      (className "validate")
                                      (style (color "white"))
                                      (value ${this.state.fontFamily})
                                      (onChange ${e=>this.handleFontFamilyChange(e)}) ))
                            (label (@ (for "appSettingsDialog-fontFamily"))
                                "Font family (e.g. Consolas, 'Migu 1M', monospace)") ))
                    (div (@ (className "row")
                            (style (margin "0")) )
                        (div (@ (className "input-field col s2"))
                            (input (@ (id "appSettingsDialog-fontSize")
                                      (type "number")
                                      (className "validate")
                                      (style (color "white"))
                                      (value ${this.state.fontSize})
                                      (onChange ${e=>this.handleFontSizeChange(e)}) ))
                            (label (@ (for "appSettingsDialog-fontSize"))
                                "Font size (in points)") ))
                    (div (@ (className "row")
                            (style (margin "0")) )
                        (div (@ (className "input-field col s2"))
                            (input (@ (id "appSettingsDialog-tabSize")
                                      (type "number")
                                      (className "validate")
                                      (style (color "white"))
                                      (value ${this.state.tabSize})
                                      (onChange ${e=>this.handleTabSizeChange(e)}) ))
                            (label (@ (for "appSettingsDialog-tabSize"))
                                "Tab size") )
                        (div (@ (className "input-field col s4"))
                            (label
                                (input (@ (type "checkbox")
                                          (className "filled-in")
                                          (checked ${this.state.useSoftTabs?"checked":""})
                                          (onChange ${e=>this.handleSoftTabsChange(e)}) ))
                                (span "Soft tabs") )))
                    (div (@ (className "row")
                            (style (margin "0")) )
                        (div (@ (className "input-field col s3"))
                            (label
                                (input (@ (type "checkbox")
                                          (className "filled-in")
                                          (checked ${this.state.wrap?"checked":""})
                                          (onChange ${e=>this.handleWrapChange(e)}) ))
                                (span "Wrap") ))
                        (div (@ (className "input-field col s3"))
                            (label
                                (input (@ (type "checkbox")
                                          (className "filled-in")
                                          (checked ${this.state.showInvisibles?"checked":""})
                                          (onChange ${e=>this.handleShowInvisiblesChange(e)}) ))
                                (span "Show Invisibles") ))
                        (div (@ (className "input-field col s3"))
                            (label
                                (input (@ (type "checkbox")
                                          (className "filled-in")
                                          (checked ${this.state.enableSnippets?"checked":""})
                                          (onChange ${e=>this.handleEnableSnippetsChange(e)}) ))
                                (span "Enable Snippets") ))
                        (div (@ (className "input-field col s3"))
                            (label
                                (input (@ (type "checkbox")
                                          (className "filled-in")
                                          (checked ${this.state.darkThemePreview?"checked":""})
                                          (onChange ${e=>this.handleDarkThemePreviewChange(e)}) ))
                                (span "Preview in dark theme") )))
                    (div (@ (className "row")
                            (style (margin "0")) )
                        (div (@ (className "input-field col s3"))
                            (label
                                (input (@ (type "checkbox")
                                          (className "filled-in")
                                          (checked ${this.state.skipDropDialog?"checked":""})
                                          (onChange ${e=>this.handleSkipDropDialogChange(e)}) ))
                                (span "Skip file drop dialog") )))
                    (div (@ (className "row")
                            (style (margin "40px 0 0 0")
                                   (color "white") ))
                        (div (@ (className "input-field col s12"))
                            (select (@ (id "appSettingsDialog-theme")
                                       (onChange ${e=>this.handleThemeChange(e)}) )
                                (option (@ (value "monokai")
                                           (selected ${"monokai"===this.state.theme?"selected":""})) "Monokai")
                                (option (@ (value "cobalt")
                                           (selected ${"cobalt"===this.state.theme?"selected":""})) "Cobalt")
                                (option (@ (value "terminal")
                                           (selected ${"terminal"===this.state.theme?"selected":""})) "Terminal")
                                (option (@ (value "tomorrow_night_bright")
                                           (selected ${"tomorrow_night_bright"===this.state.theme?"selected":""})) "Tomorrow Night Bright")
                                (option (@ (value "chrome")
                                           (selected ${"chrome"===this.state.theme?"selected":""})) "Chrome")
                                (option (@ (value "kuroir")
                                           (selected ${"kuroir"===this.state.theme?"selected":""})) "Kuroir")
                                (option (@ (value "textmate")
                                           (selected ${"textmate"===this.state.theme?"selected":""})) "Textmate") )
                            (label (@ (for "appSettingsDialog-theme"))
                                "Theme") )) )))
            (div (@ (style (display "flex")
                           (justifyContent "center") ))
                (button (@ (style (textTransform "none")
                                  (margin "0 3px 0 3px")
                                  (width "9em") )
                           (className "btn grey darken-3")
                           (onClick ${e=>this.handleCancelClick(e)}) )
                    (i (@ (className "material-icons large")) "cancel")
                    (span (@ (style (margin "0 10px 10px 10px")
                                    (display "inline-block")
                                    (vertical-align "middle") )) "Cancel") )
                (button (@ (style (textTransform "none")
                                  (margin "0 3px 0 3px")
                                  (width "9em") )
                           (className "btn blue darken-2")
                           (onClick ${e=>this.handleOkClick(e)}) )
                    (i (@ (className "material-icons large")) "check")
                    (span (@ (style (margin "0 10px 10px 10px")
                                    (display "inline-block")
                                    (vertical-align "middle") )) "OK") ) ))`}}const wi=async(e,t,i,n,...s)=>await Mt(e,i,Object.assign({inputFormat:"md",dataFormat:"object"},t||{}),n,...s),yi=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function vi({app:e}){return[{name:"new-window",fn:(e,t)=>(...e)=>(Xt(),"")},{name:"open",fn:(t,i)=>async t=>{if(t){const i=si.filePath?await Kt(si.filePath):null,n=await qt(i,t),s=await It(n);return e.fileDropDialogRef.current.openFile(n,s),e.afterFileOpen(),""}return e.handleFileOpenClick({}),""}},{name:"save",fn:(t,i)=>(...t)=>(e.handleSaveClick({}),"Saving...")},{name:"saveas",fn:(t,i)=>async t=>{if(t){const i=si.filePath?await Kt(si.filePath):null;return await e.fileSaveAs(i,t),"Saved."}return e.handleSaveAsClick({}),""}},{name:"export",fn:(t,i)=>async t=>{if(!ci(si.inputFormat))throw new Error(`Exporting of ${si.inputFormat} format is not supported.`);if(t){const i=si.filePath?await Kt(si.filePath):null;return await e.fileExport(i,t),"Exported."}return e.handleExportClick({}),""}},{name:"preview",fn:(t,i)=>(...t)=>(e.handleShowClick({}),"")},{name:"sync",fn:(t,i)=>t=>(e.setState({syncPreview:"on"===t||!0===t}),"")},{name:"preview-format",fn:(t,i)=>t=>(e.setState({isPdf:"pdf"===t}),"")},{name:"scripting",fn:(t,i)=>t=>(e.setState({useScripting:"on"===t||!0===t}),"")},{name:"entire-text",fn:(t,i)=>t=>e.getEntireText(t)},{name:"selected-text",fn:(t,i)=>t=>e.getSelectedText(t)},{name:"insert",fn:(t,i)=>t=>e.insertText(t)},{name:"$>",fn:(e,t)=>(...e)=>ti.runCommandAST([[{symbol:"$>"},e.join(" ")]])},{name:"help",fn:(e,t)=>e=>(Vt("https://github.com/shellyln/mdne"),"")}]}function Ci({getCurrentAceId:e}){return[{name:"mode",fn:(t,i)=>t=>{if(!t)throw new Error("Editor mode name is not specified.");si.inputFormat=t;const i=di(t);if(i)return si.AceEditor[e()].session.setMode(i),ni(),si.invalidate(),"";throw new Error("Invalid editor mode name: "+t)}}]}function xi({getCurrentAceId:e}){return[{name:"md",fn:(t,i)=>(...t)=>{switch(t[0]){case"table":{const i=Math.max(1,Number(t[1]||3)),n=Math.max(1,Number(t[2]||3));let s=`\n|${Array(n).fill("").map(((e,t)=>`R_C${t}`)).join("|")}|\n|${Array(n).fill("").map(((e,t)=>"----")).join("|")}|\n`;for(let e=0;e<i;e++)s+=`|${Array(n).fill("").map(((t,i)=>`R${e}C${i}`)).join("|")}|\n`;const a=si.AceEditor[e()];a.session.insert(a.getCursorPosition(),s)}return"";case"list":{const i=Math.max(1,Number(t[1]||3));let n="\n";for(let e=0;e<i;e++)n+=`* item ${e}\n`;const s=si.AceEditor[e()];s.session.insert(s.getCursorPosition(),n)}return"";case"o-list":{const i=Math.max(1,Number(t[1]||3));let n="\n";for(let e=0;e<i;e++)n+=`1. item ${e}\n`;const s=si.AceEditor[e()];s.session.insert(s.getCursorPosition(),n)}return"";case"checkbox":{const i=Math.max(1,Number(t[1]||3));let n="\n";for(let e=0;e<i;e++)n+=`* [${e%2==0?"X":" "}] item ${e}\n`;const s=si.AceEditor[e()];s.session.insert(s.getCursorPosition(),n)}return"";case"blockquote":case"quote":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n> This is blockquote.\n>> This is blockquote.\n")}return"";case"link":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n[This is inline-style link with title](https://github.com/shellyln/mdne "mdne")\n')}return"";case"image":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n![alt text](https://shellyln.github.io/assets/image/mdne-logo.svg "Logo" =300x100)\n')}return"";case"toc":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n[[TOC]]\n")}return"";case"hr":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n----\n")}return"";case"math":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n$$$\nsum_(i=1)^n i^3=((n(n+1))/2)^2\n$$$\n")}return"";case"inline-math":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," $$sum_(i=1)^n i^3=((n(n+1))/2)^2$$ ")}return"";case"mathjax":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" crossorigin="anonymous"><\/script>\n')}return"";case"code":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n```javascript\n\nconst x = 0;\n\n```\n")}return"";case"inline-code":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," `const x = 0` ")}return"";case"uml":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n@startuml\nAlice -> Bob: Authentication Request\nBob --\x3e Alice: Authentication Response\n\nAlice -> Bob: Another authentication Request\nAlice <-- Bob: Another authentication Response\n@enduml\n")}return"";case"emoji":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," :wink: :crush: :cry: :tear: :laughing: :yum: ")}return"";case"italic":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," *This is italic* ")}return"";case"italic-alt":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," _This is italic_ ")}return"";case"bold":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," **This is bold** ")}return"";case"bold-alt":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," __This is bold__ ")}return"";case"strikethrough":case"strikethru":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," ~~This is strikethrough~~ ")}return"";case"mark":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," ==This is mark== ")}return"";case"ins":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition()," ++This is ins++ ")}return"";case"footnote":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\nThis is footnote 1 link[^first].\n[^first]: Footnote text.\n")}return"";case"inline-footnote":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\nThis is inline footnote^[Text of inline footnote.].\n")}return"";case"deflist":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\nTerm 1\n    ~ Definition 1a\n    ~ Definition 1b\n")}return"";case"lazy-deflist":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\nTerm 1\n:   Definition 1a\nwith lazy continuation.\n\n    paragraph 1\n\n        { code block }\n    paragraph 3\n:   Definition 1b\n\n")}return"";case"abbr":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\nThis is HTML abbreviation example.\n*[HTML]: Hyper Text Markup Language\n")}return"";case"pagebreak":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n<div style="page-break-before:always"></div>\n')}return"";case"h1":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n# This is a header.\n")}return"";case"h1-no-toc":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n<p style="font-size: 2em; font-weight: bold; border-bottom: 1px solid #eaecef; padding-bottom: .3em;">This is a header.</p>\n')}return"";case"h2":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n## This is a header.\n")}return"";case"h2-no-toc":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n<p style="font-size: 1.5em; font-weight: bold; border-bottom: 1px solid #eaecef; padding-bottom: .3em;">This is a header.</p>\n')}return"";case"h3":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n### This is a header.\n")}return"";case"h4":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n#### This is a header.\n")}return"";case"h5":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n##### This is a header.\n")}return"";case"h6":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n###### This is a header.\n")}return"";case"style":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n<style>h4 { background-color: cyan; }</style>\n")}return"";case"comment":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n\x3c!-- This is a comment. --\x3e\n")}return"";case"char-entity-ref":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n&amp;&lt;&gt;&quot;&apos;&nbsp;\n&sup3;&frac34;&plusmn;&times;&divide;&para;&sect;&middot;&laquo;&raquo;\n&copy;&reg;&trade;&yen;&euro;$&curren;&pound;&cent;\n")}return"";case"escape":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"\n\\<style>h5 { background-color: cyan; }\\</style>\n")}return"";case"embedded-image":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n%%%(Image(@(src"https://shellyln.github.io/assets/image/mdne-logo.svg")(width 300)(height 100)(unit "px")(alt "Logo")))\n')}return"";case"embedded-uml":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n%%%(PlantUml """\nAlice -> Bob: Authentication Request\nBob --\x3e Alice: Authentication Response\n\nAlice -> Bob: Another authentication Request\nAlice <-- Bob: Another authentication Response\n""")\n')}return"";case"embedded-style":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n%%%(Style(@(src"https://shellyln.github.io/menneu/assets/style/playground.css")))\n')}return"";case"svg":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n%%%(Svg (@ (width 100)(height 100)(unit "mm"))\n\n)\n')}return"";case"canvas":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(Canvas (-> (ctx) (::ctx@moveTo  10  10)\n                  (::ctx@lineTo 190 190)\n                  (::ctx:strokeStyle="rgba(255,128,0,0.2)")\n                  (::ctx@stroke)\n                  (::ctx@beginPath) ))\n')}return"";case"line":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(Line (@(x 0)(y 0)(lineWidth 1)(stroke)(strokeColor "blue")(points ($list 10 10 20 40 30 90 ))))\n')}return"";case"rect":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(Rect(@(x 5)(y 5)(width 70)(height 20)(lineWidth 3)(stroke)(strokeColor "blue")(fill)(fillColor "darkblue")))\n')}return"";case"roundrect":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(RoundRect(@(x 5)(y 5)(width 70)(height 20)(lineWidth 3)(r 3)(stroke)(strokeColor "blue")(fill)(fillColor "darkblue")))\n')}return"";case"qr":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(Qr (@ (x 5)(y 7)(cellSize 0.8)(fill)(fillColor "darkblue")(data "Hello")))\n')}return"";case"code128":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(Code128 (@ (x 5)(y 7)(elementWidth 0.66)(height 15)(quietHeight 0)(textHeight 7)\n            (font "7px \'OCRB\'")(fill)(fillColor "darkblue")(data "Hello") ))\n')}return"";case"code39":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(Code39 (@ (x 5)(y 7)(narrowWidth 0.66)(wideWidth 1.32)(height 15)(quietHeight 0)(textHeight 7)\n           (font "7px \'OCRB\'")(fill)(fillColor "darkblue")(data "HELLO") ))\n')}return"";case"gtin13":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(Gtin13 (@ (x 5)(y 7)(elementWidth 0.66)(height 15)(quietHeight 0)(textHeight 7)\n           (font "7px \'OCRB\'")(fill)(fillColor "darkblue")(data "123456789012") ))\n')}return"";case"gtin8":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'\n(Gtin8 (@ (x 5)(y 7)(elementWidth 0.66)(height 15)(quietHeight 0)(textHeight 7)\n          (font "7px \'OCRB\'")(fill)(fillColor "darkblue")(data "1234567") ))\n')}return"";case"print-preview":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),"<script>window.print()<\/script>")}return"";case"html5":{const t=si.AceEditor[e()];t.session.insert(t.getCursorPosition(),'(Html5\n(head (title "Untitled")\n      (meta (@ (charset "UTF-8")))\n      (NormalizeCss)\n      (PaperCss)\n\n    (style (@ (dangerouslySetInnerHTML """$concat\n        /* You can write additional styles here. */\n        /*\n        body {\n            background-color: blue;\n        }\n        */\n    """) )))\n\n(body (@ (class "A4"))\n    (section (@ (class "sheet padding-10mm"))\n        Hello!\n        )))\n')}return"";default:return""}}}]}const Si="_mdne_app_settings__Xlnuf3Ao",ki=JSON.stringify({version:2,editor:{},renderer:{},app:{}});class bi extends React.Component{constructor(e){super(e),this.state={},this.state.stretched=!0,this.state.syncPreview=!1,this.state.isPdf=!1,this.state.useScripting=!1,this.state.currentAceId="editor",this.state.splitterMoving=!1,this.state.darkThemePreview=!1,this.state.counter=0,this.aceFontSize=14,this.scheduleRerenderPreview=!1,this.savedEditorStyleWidth=null,this.savedPreviewScrollY=0,this.commandBoxRef=React.createRef(),this.editorRef=React.createRef(),this.editorPlaceholderRef=React.createRef(),this.splitterRef=React.createRef(),this.rootRef=React.createRef(),this.fileDropDialogRef=React.createRef(),this.fileOpenDialogRef=React.createRef(),this.fileSaveDialogRef=React.createRef(),this.settingsDialogRef=React.createRef(),si.invalidate=()=>this.setState({counter:this.state.counter+1}),window.onbeforeunload=e=>{if(!si.AceEditor[this.state.currentAceId].session.getUndoManager().isClean()&&!Tt)return e.preventDefault(),""},Zt.install((e=>{const t=()=>this.state.currentAceId,i=[...vi({app:this}),...Ci({getCurrentAceId:t}),...xi({getCurrentAceId:t})];return e.funcs=(e.funcs||[]).concat(i),e}));{var t,i,n,s;const e=this.getAppSettings();this.state.darkThemePreview=null!==(t=null===(i=e.renderer)||void 0===i?void 0:i.darkThemePreview)&&void 0!==t&&t,si.skipDropDialog=null!==(n=null===(s=e.app)||void 0===s?void 0:s.skipDropDialog)&&void 0!==n&&n}{const e=window.navigator.userAgent;this.isChrome=e.match(" Chrome/")&&!e.match(" CriOS/")&&!e.match(" OPR/")&&!e.match(" Presto/")&&!e.match(" Vivaldi/")&&!e.match(" Iron Safari/")&&!e.match(" Sleipnir/")&&!e.match(" Mobile Safari/")}}componentDidMount(){{const e=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(e,{constrainWidth:!1})}{const e=document.querySelectorAll(".tooltipped");M.Tooltip.init(e,{})}{const e=document.querySelectorAll("select");M.FormSelect.init(e,{})}{const e=document.querySelectorAll(".command-box-input.autocomplete");M.Autocomplete.init(e,{data:Object.assign({"new-window":null,open:null,'open "path/to/file/opening"':null,save:null,saveas:null,'saveas "path/to/file/to/save/as"':null,export:null,'export "path/to/file/to/export"':null,preview:null,"sync on":null,"sync off":null,"preview-format pdf":null,"preview-format html":null,"scripting on":null,"scripting off":null,"entire-text":null,"selected-text":null,'insert "text"':null,"$resolve-pipe ($> ls -al) (<- insert) (-> () nil)":null,"$> some-shell-cmd cmd-options":null,help:null,"help topic-name":null},{"mode md":null,"mode html":null,"mode lisp":null,"mode tex":null,"mode latex":null,"mode css":null,"mode less":null,"mode sass":null,"mode scss":null,"mode json":null,"mode json5":null,"mode js":null,"mode jsx":null,"mode ts":null,"mode tsx":null,"mode svg":null,"mode xml":null,"mode yaml":null,"mode toml":null,"mode ini":null,"mode graphql":null,"mode protobuf":null,"mode sql":null,"mode csharp":null,"mode golang":null,"mode ruby":null,"mode rust":null,"mode python":null,"mode java":null,"mode kotlin":null,"mode r":null,"mode sh":null,"mode dockerfile":null,"mode makefile":null,"mode text":null},{"md table rows cols":null,"md list rows":null,"md o-list rows":null,"md checkbox rows":null,"md blockquote":null,"md link":null,"md image":null,"md toc":null,"md hr":null,"md math":null,"md inline-math":null,"md mathjax":null,"md code":null,"md inline-code":null,"md uml":null,"md emoji":null,"md italic":null,"md italic-alt":null,"md bold":null,"md bold-alt":null,"md strikethru":null,"md mark":null,"md ins":null,"md footnote":null,"md inline-footnote":null,"md deflist":null,"md lazy-deflist":null,"md abbr":null,"md pagebreak":null,"md h1":null,"md h1-no-toc":null,"md h2":null,"md h2-no-toc":null,"md h3":null,"md h4":null,"md h5":null,"md h6":null,"md style":null,"md comment":null,"md char-entity-ref":null,"md escape":null,"md embedded-image":null,"md embedded-uml":null,"md embedded-style":null,"md svg":null,"md canvas":null,"md line":null,"md rect":null,"md roundrect":null,"md qr":null,"md code128":null,"md code39":null,"md gtin13":null,"md gtin8":null,"md print-preview":null,"md html5":null})})}if(window.dialogPolyfill){const e=document.querySelectorAll("dialog");for(let t=0;t<e.length;t++){const i=e[t];dialogPolyfill.registerDialog(i)}}{const e=this.getAppSettings();ace.config.loadModule("ace/ext/language_tools",(()=>{var t;si.AceEditor[this.state.currentAceId].setOptions({...JSON.parse(ki).editor,...null!==(t=e.editor)&&void 0!==t?t:{}})}))}document.onkeyup=e=>{e.ctrlKey&&e.shiftKey&&79===e.keyCode&&this.commandBoxRef.current.focus()};const e=()=>{si.inputFormat="md",ai(!1),ni();const e=si.AceEditor[this.state.currentAceId];e.clearSelection(),e.session.setMode(di(si.inputFormat)),e.setValue(""),e.clearSelection(),e.session.getUndoManager().markClean(),this.setState({counter:this.state.counter+1})};Yt().then((t=>{if(t){si.filePath=t.path,si.inputFormat=li(si.filePath),ai(!1),ni();const e=si.AceEditor[this.state.currentAceId];e.clearSelection(),e.session.setMode(di(si.inputFormat)),e.setValue(t.text),e.clearSelection(),e.session.getUndoManager().markClean(),e.moveCursorTo(0,0),this.setState({counter:this.state.counter+1})}else e(),si.skipDropDialog||this.openFileOpenDialog()})).catch((t=>{e(),si.skipDropDialog||this.openFileOpenDialog()}))}getAppSettings(){return JSON.parse(window.localStorage.getItem(Si)||ki)}saveAppSettings(e){return window.localStorage.setItem(Si,JSON.stringify(e)),e}afterFileOpen(){this.rootRef.current.contentWindow.location.replace(`${Ft}empty.html`),this.setState({stretched:!0}),this.savedEditorStyleWidth=null,this.savedPreviewScrollY=0,this.editorRef.current.outerWrapRef.current.style.width=null,this.editorPlaceholderRef.current.style.width=null,document.activeElement.blur(),setTimeout((()=>{si.AceEditor[this.state.currentAceId].resize(!0)}),30)}openFileOpenDialog(){this.fileDropDialogRef.current.showModal({aceId:this.state.currentAceId,fileOpenDialog:this.fileOpenDialogRef.current},(()=>this.afterFileOpen()))}async handleFileOpenClick(e){(si.AceEditor[this.state.currentAceId].session.getUndoManager().isClean()||await oi("Changes you made may not be saved.\nAre you sure want to discard changes?"))&&this.openFileOpenDialog()}handleStretchedClick(e){if(this.setState({stretched:!this.state.stretched}),this.state.stretched)this.editorRef.current.outerWrapRef.current.style.width=this.savedEditorStyleWidth,this.editorPlaceholderRef.current.style.width=this.savedEditorStyleWidth,setTimeout((()=>this.rootRef.current.contentWindow.scrollTo(this.rootRef.current.contentWindow.scrollX,this.savedPreviewScrollY)),30);else{try{this.savedEditorStyleWidth=this.editorRef.current.outerWrapRef.current.style.width,this.savedPreviewScrollY=this.rootRef.current.contentWindow.scrollY}catch(e){}this.editorRef.current.outerWrapRef.current.style.width=null,this.editorPlaceholderRef.current.style.width=null}document.activeElement.blur(),setTimeout((()=>{si.AceEditor[this.state.currentAceId].resize(!0)}),30)}handleSyncPreviewClick(e){this.setState({syncPreview:!this.state.syncPreview}),document.activeElement.blur()}handleIsPdfClick(e){this.setState({isPdf:!this.state.isPdf}),document.activeElement.blur()}handleUseScriptingClick(e){this.setState({useScripting:!this.state.useScripting}),document.activeElement.blur()}handleShowClick(e){this.state.stretched&&(this.editorRef.current.outerWrapRef.current.style.width=this.savedEditorStyleWidth,this.editorPlaceholderRef.current.style.width=this.savedEditorStyleWidth),this.state.isPdf&&(window._MDNE_BACKEND_CAPS_NO_PDF_RENDERER||window._MDNE_BACKEND_CAPS_NO_PDF_PREVIEW_PLUGIN)||this.setState({stretched:!1});const t=si.AceEditor[this.state.currentAceId];ci(si.inputFormat)?(this.state.isPdf?wi(t.getValue(),{inputFormat:si.inputFormat,outputFormat:"pdf",rawInput:!("md"!==si.inputFormat&&"html"!==si.inputFormat||this.state.useScripting)},null,si.filePath).then((e=>{this.rootRef.current.contentWindow.location.replace(e)})).catch((async e=>{console.error(e),this.rootRef.current.contentWindow.location.replace(`${Ft}error.html`)})):wi(t.getValue(),{inputFormat:si.inputFormat,outputFormat:"html",rawInput:!("md"!==si.inputFormat&&"html"!==si.inputFormat||this.state.useScripting),darkTheme:!!this.state.darkThemePreview},null,si.filePath).then((e=>{this.rootRef.current.contentWindow.location.replace(e),setTimeout((()=>{var e,t;return this.rootRef.current.contentWindow.scrollTo(this.rootRef.current.contentWindow.scrollX,Math.min(this.savedPreviewScrollY,null!==(e=null===(t=this.rootRef.current.contentWindow.document.documentElement)||void 0===t?void 0:t.scrollHeight)&&void 0!==e?e:this.savedPreviewScrollY))}),30)})).catch((async e=>{console.error(e),this.rootRef.current.contentWindow.location.replace(`${Ft}error.html`)})),setTimeout((()=>{si.AceEditor[this.state.currentAceId].resize(!0)}),30)):(console.error(`Preview of ${si.inputFormat} format is not supported.`),this.rootRef.current.contentWindow.location.replace(`${Ft}error.html`)),document.activeElement.blur()}handleSaveClick(e){si.filePath?si.AceEditor[this.state.currentAceId].execCommand("save"):this.handleSaveAsClick(e)}async fileSaveAs(e,t){const i=si.AceEditor[this.state.currentAceId],n=await Wt(i.getValue(),e,t);si.filePath=n.path,si.inputFormat=li(si.filePath),i.session.setMode(di(si.inputFormat)),i.session.getUndoManager().markClean(),ai(!1),ni(),this.setState({counter:this.state.counter+1})}handleSaveAsClick(e){this.fileSaveDialogRef.current.showModal({title:"Save as",currentAceId:this.state.currentAceId,currentFilePath:si.filePath,forExport:!1,fileTypes:ui.saveAsFilter,intent:"saveas"},(async(e,t)=>{try{await this.fileSaveAs(e,t)}catch(e){await ri(e)}}))}async fileExport(e,t){const i=si.AceEditor[this.state.currentAceId],n=t.lastIndexOf(".")>=0?t.toLowerCase().slice(t.lastIndexOf(".")):"";await wi(i.getValue(),{inputFormat:si.inputFormat,outputFormat:".pdf"===n?"pdf":"html",rawInput:!("md"!==si.inputFormat&&"html"!==si.inputFormat||this.state.useScripting)},null,si.filePath,e,t)}getEntireText(){return si.AceEditor[this.state.currentAceId].getValue()}getSelectedText(){return si.AceEditor[this.state.currentAceId].getSelectedText()}insertText(e){const t=si.AceEditor[this.state.currentAceId];return t.session.insert(t.getCursorPosition(),e),e}async handleExportClick(e){ci(si.inputFormat)?this.fileSaveDialogRef.current.showModal({title:"Export",currentAceId:this.state.currentAceId,currentFilePath:si.filePath,forExport:!0,fileTypes:ui.exportFilter,intent:"export"},(async(e,t)=>{try{await this.fileExport(e,t)}catch(e){await ri(e)}})):await ri(`Preview of ${si.inputFormat} format is not supported.`)}handleSettingsClick(e){var t,i;const n=si.AceEditor[this.state.currentAceId],s=this.getAppSettings();this.settingsDialogRef.current.showModal({editor:n.getOptions(),renderer:null!==(t=s.renderer)&&void 0!==t?t:{},app:null!==(i=s.app)&&void 0!==i?i:{}},(e=>{var t,i,s;e.version=2,n.setOptions(e.editor),this.saveAppSettings(e),this.setState({darkThemePreview:null!==(t=null===(i=e.renderer)||void 0===i?void 0:i.darkThemePreview)&&void 0!==t&&t}),si.skipDropDialog=null===(s=e.app)||void 0===s?void 0:s.skipDropDialog}))}handleAceEditorOnChange(e){if(!si.fileChanged){const e=si.AceEditor[this.state.currentAceId];if(!e.curOp||!e.curOp.command.name)return;ai(!0),ni()}if(!this.state.stretched&&this.state.syncPreview&&!this.state.isPdf){if(!ci(si.inputFormat))return;this.scheduleRerenderPreview||(this.scheduleRerenderPreview=!0,setTimeout((()=>{const e=si.AceEditor[this.state.currentAceId];wi(e.getValue(),{inputFormat:si.inputFormat,outputFormat:"html",rawInput:!("md"!==si.inputFormat&&"html"!==si.inputFormat||this.state.useScripting),darkTheme:!!this.state.darkThemePreview},null,si.filePath).then((e=>{e.startsWith("data:")||e.startsWith("blob:")?this.rootRef.current.contentWindow.location.replace(e):this.rootRef.current.contentWindow.location.reload(!0),this.scheduleRerenderPreview=!1})).catch((e=>{this.scheduleRerenderPreview=!1,console.error(e)}))}),3e3))}}handleAceEditorOnChangeScrollTop(e,t){if(!this.state.stretched&&!this.state.isPdf)try{const i=e/t,n=this.rootRef.current.contentWindow.document.documentElement.scrollHeight*i;this.rootRef.current.contentWindow.scrollTo(this.rootRef.current.contentWindow.scrollX,n),this.savedPreviewScrollY=n}catch(e){}}handleAceEditorOnChangeScrollLeft(e){}handleCommandBoxOnKeyDown(e){const t=()=>{this.commandBoxRef.current.value="",M.Autocomplete.getInstance(document.querySelectorAll(".command-box-input.autocomplete")[0]).close()};if(13===e.keyCode)if(""===this.commandBoxRef.current.value.trim())t();else{const e=`(${this.commandBoxRef.current.value})`;Zt(e).then((e=>{t(),"string"==typeof e&&""===e.trim()||null!=e&&(Array.isArray(e)&&0===e.length||M.toast({html:yi(String(e)).replace(/\r?\n/g,"<br>"),classes:"teal darken-4"}))})).catch((e=>{t(),M.toast({html:yi(String(e)),classes:"red darken-4"})}))}else 27===e.keyCode&&(t(),document.activeElement.blur())}handleCommandBoxOnBlur(e){M.Toast.dismissAll(),si.AceEditor[this.state.currentAceId].focus()}handleSplitterOnPointerDown(e){this.setState({splitterMoving:!0}),window.onpointermove=e=>{const t=Math.max(Math.min(e.clientX-5,window.innerWidth-440),400),i=`${Math.round(t/window.innerWidth*100)}%`;this.editorRef.current.outerWrapRef.current.style.width=i,this.editorPlaceholderRef.current.style.width=i},window.onpointerup=e=>{window.onpointermove=null,window.onpointerup=null,this.splitterRef.current.releasePointerCapture(e.pointerId),this.setState({splitterMoving:!1}),setTimeout((()=>{this.rootRef.current.contentWindow.scrollTo(this.rootRef.current.contentWindow.scrollX,this.savedPreviewScrollY),si.AceEditor[this.state.currentAceId].resize(!0)}),30)},this.splitterRef.current.setPointerCapture(e.pointerId)}render(){const e="BROWSER_EMULATION"===window._MDNE_BACKEND_TYPE,t=`${Ft}empty.html`;return lsx`
        (Template
            (div (@ (className "AppMainMenuWrap"))
                (a (@ (className "AppMainMenu dropdown-trigger btn-floating")
                      (data-target "dropdown1") )
                    (i (@ (className "AppMainMenuIcon material-icons large")) "dehaze") )
                (ul (@ (id "dropdown1")
                       (className "dropdown-content") )
                    (MenuItem (@ (icon "add_box")
                                 (caption "New window")
                                 (onClick ${()=>{Xt()}}) ))
                    (MenuItem (@ (icon "folder_open")
                                 (caption "Open...")
                                 (onClick ${e=>this.handleFileOpenClick(e)}) ))
                    (MenuItem (@ (icon "save")
                                 (caption "Save (Ctrl+S)")
                                 (onClick ${e=>this.handleSaveClick(e)}) ))
                    (MenuItem (@ (icon "save")
                                 (caption "Save as...")
                                 (onClick ${e=>this.handleSaveAsClick(e)}) ))
                    (MenuItem (@ (icon "publish")
                                 (caption "Export...")
                                 (onClick ${e=>this.handleExportClick(e)}) ))
                    (MenuDivider)
                    (MenuItem (@ (icon "find_in_page")
                                 (caption "Find... (Ctrl+F)")
                                 (onClick ${()=>{si.AceEditor.editor.execCommand("find")}}) ))
                    (MenuDivider)
                    (MenuItem (@ (icon "settings")
                                 (caption "Settings...")
                                 (onClick ${e=>this.handleSettingsClick(e)}) ))
                    (MenuItem (@ (icon "help_outline")
                                 (caption "Help")
                                 (onClick ${()=>Vt("https://github.com/shellyln/mdne")}) )) )
                (Switch (@ (caption "Sync preview")
                           (offText "OFF")
                           (onText  "ON")
                           (elClass "hide-on-smallest")
                           (checked ${this.state.syncPreview})
                           (onClick ${e=>this.handleSyncPreviewClick(e)}) ))
                ($if ${!window._MDNE_BACKEND_CAPS_NO_PDF_RENDERER}
                    (Switch (@ (caption "Preview format")
                            (offText "HTML")
                            (onText  "PDF")
                            (elClass "hide-on-smallest")
                            (checked ${this.state.isPdf})
                            (onClick ${e=>this.handleIsPdfClick(e)}) )))
                (Switch (@ (caption "Scripting")
                           (offText "OFF")
                           (onText  "ON")
                           (elClass "hide-on-smallest")
                           (checked ${this.state.useScripting})
                           (onClick ${e=>this.handleUseScriptingClick(e)}) ))
                (span (@ (style (flexGrow "2"))) " ")
                (div (@ (className "row command-box-input-outer") )
                    (div (@ (className "input-field col s9 command-box-input-inner") )
                        (input (@ (ref ${this.commandBoxRef})
                                  (className "CommandBoxInput command-box-input autocomplete")
                                  (type "text")
                                  (placeholder ($concat
                                      "Command palette    (" ${e&&this.isChrome?"Alt+Ctrl+Shift+O":"Ctrl+Shift+O"} ")" ))
                                  (spellcheck "false")
                                  (onBlur ${e=>this.handleCommandBoxOnBlur(e)})
                                  (onKeyDown ${e=>this.handleCommandBoxOnKeyDown(e)}) ))))
                (button (@ (style (textTransform "none")
                                  (margin "0 3px") )
                           (className "btn tooltipped")
                           (data-tooltip "Update preview")
                           (onClick ${e=>this.handleShowClick(e)}) )
                    (i (@ (className "material-icons")) "visibility") )
                (button (@ (style (textTransform "none")
                                  (margin "0 3px") )
                           (className "btn tooltipped")
                           (data-tooltip "Toggle preview")
                           (onClick ${e=>this.handleStretchedClick(e)}) )
                    (i (@ (className "material-icons")) "chrome_reader_mode") ))
            (div (@ (className "AppMainContentWrap"))
                (AceEditor (@ (ref ${this.editorRef})
                              (id "editor")
                              (stretched ${!!this.state.stretched})
                              (collapsed ${!!this.state.splitterMoving})
                              (fontSize ${this.aceFontSize})
                              (onSaveAs ${e=>this.handleSaveAsClick(e)})
                              (onChange ${e=>this.handleAceEditorOnChange(e)})
                              (onChangeScrollTop ${(e,t)=>this.handleAceEditorOnChangeScrollTop(e,t)})
                              (onChangeScrollLeft ${e=>this.handleAceEditorOnChangeScrollLeft(e)}) ))
                (div (@ (ref ${this.editorPlaceholderRef})
                        (className ($concat "AceEditorPlaceholder"
                                   ${this.state.splitterMoving?"":" collapsed"}) ) ))
                (div (@ (ref ${this.splitterRef})
                        (className ($concat "Splitter"
                                   ${this.state.stretched?" collapsed":""}))
                        (onPointerDown ${e=>this.handleSplitterOnPointerDown(e)}) ))
                (div (@ (className ($concat "OutputIframePlaceholder"
                                   ${this.state.splitterMoving?"":" collapsed"}) ) ))
                (iframe (@ (ref ${this.rootRef})
                           (src ${t})
                           (style (background-color ${this.state.darkThemePreview&&"md"===si.inputFormat?"#1b1f23":"white"}))
                           ; (sandbox "")
                           (className ($concat "OutputIframe"
                                      ${this.state.stretched||this.state.splitterMoving?" collapsed":""}) ) ))
                (div (@ (id "appIndicatorBar")
                        (className "AppIndicatorBar")) "") )
            (FileDropDialog (@ (ref ${this.fileDropDialogRef})))
            (FileOpenDialog (@ (ref ${this.fileOpenDialogRef})))
            (FileSaveDialog (@ (ref ${this.fileSaveDialogRef})))
            (SettingsDialog (@ (ref ${this.settingsDialogRef}))) )`}}const Ai=liyad.LSX({jsx:React.createElement,jsxFlagment:React.Fragment,components:{AceEditor:hi,FileDropDialog:pi,FileOpenDialog:mi,FileSaveDialog:fi,SettingsDialog:gi,MenuItem:({icon:e,caption:t,onClick:i})=>lsx`
        (li (a (@ (onClick ${i}))
            (i (@ (className "material-icons")) ${e})
            ${t} ))`,MenuDivider:()=>lsx`(li (@ (className "divider") (tabIndex -1)))`,Switch:({caption:e,offText:t,onText:i,elClass:n,checked:s,onClick:a})=>lsx`
        (div (@ (className ("switch" ${n||""})))
            (label ${e})(br)
            (label
                ${t}
                (input (@ (type "checkbox")
                          (checked ${s})
                          (onClick ${a}) ))
                (span  (@ (className "lever")))
                ${i} ))`,App:bi}});window.lsx=Ai,(async()=>{await async function(){if(ti)return ti;ti=(await Gt.loadParams())[0],await ti.setFrontend(Jt.handle(ei))}(),ReactDOM.render(lsx`(App)`,document.getElementById("app"))})()})();
//# sourceMappingURL=index.js.map